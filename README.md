The code is quite terrible of course. Live with it.
